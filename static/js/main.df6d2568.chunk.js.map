{"version":3,"sources":["consts/data.js","consts/colors.js","utils/data.js","getData.js","components/CountrySelect.jsx","components/Header.jsx","components/NestedBoxes.jsx","components/Charts.jsx","components/App.jsx","index.jsx","utils/display.js"],"names":["TABLE_DELIN","MULTI_LINE_TEXT_DELIN","CONFIGURABLE_GID_NAMES","GID_MAP","home","CONFIG_FIELDS","chartId","sourceGid","element","displayName","capPercentage","percentageDecimals","coarseIntegerFormatting","colorOverride","chartType","modelled","formula","hidden","valueField","percentage","DATA_FIELDS","country_iso_code","sourceYear","value","year","indicator","indicator_description","sex","age","population_segment","population_sub_group","country_name","area_name","geographic_scope","value_upper","value_lower","value_comment","unit_format","source_organization","source_database","source_display","notes","modality","modality_category","import_file","import_timestamp","row_id","suppressed","GENERATED_FIELDS","DISPLAY_NAME","DISPLAY_VALUE","DISPLAY_VALUE_LOWER","toUpperCase","DISPLAY_VALUE_UPPER","themePrimary","sand","themeSecondary","indigo","headerColor","gold","colorGroups","orange","grass","plum","tomato","sky","brown","violet","fillIntensity","strokeIntensity","radColors","red","crimson","pink","purple","blue","cyan","teal","green","mint","lime","yellow","amber","gray","mauve","slate","sage","olive","bronze","getRC","radColor","idx","Object","keys","replace","SPECIAL_FILTERS_MAP","_NONE_","_","negate","identity","_SOMETHING_","_ANY_","stubTrue","defaultCompFn","cellVal","filterVal","toLowerCase","getUrl","gid","configParser","row","C","each","key","filterByCountryGenerator","selectedIso","D","getElements","chartConfig","filter","k","startsWith","getSetting","chartConfigsMap","field","get","getField","getFieldBoolean","getFormula","getBounds","vLower","vUpper","parseFloat","getColors","chartSettings","chartElements","visibleElements","groupIdx","parseInt","Math","abs","length","baseColors","colors","map","push","transformYearRange","range","result","exec","y1","y2","String","getFilter","allChartsFilter","allElementsFilter","elementFilter","backupFilters","getRow","chartSourceData","matchingRows","every","maxBy","r","Number","getDataPoint","set","G","capAndFormat","displayValue","options","cap","decimals","displayPercent","capValue","forEach","F","v","cv","coarseFormatting","displayNumber","getCalculatedDataPoint","dataPoints","rawFormula","convertedFormula","eval","error","console","warn","test","isNumber","memoizedGetAllDataFromTab","memoize","async","csv","catch","e","getCharts","chartIds","Promise","all","d","getCountryDataFromTab","getterMap","table","getTable","text","getText","getChart","getter","getChartOrTable","log","elements","textValues","countryIso","type","name","isPercentage","rowNames","uniq","elem","split","colNames","data","rn","values","cn","column","sheetRow","year_range","isTimeseries","years_arr","elementNameMap","getSiteData","homeRows","lastConfiguredRow","findLast","setConfigGids","dictionary","countries","baseConfigs","configs","shaped","groupBy","uniqBy","c","chart_id","id","mapValues","configParams","elemDetails","elementName","getChartConfigs","CountrySelect","handleCountryChange","FormControl","sx","width","marginTop","marginBottom","InputLabel","Select","labelId","label","onChange","MenuItem","iso","Header","Box","flexGrow","AppBar","position","background","Toolbar","BUFFER_RATIO","TEXT_BUFFER_RATIO","DEFAULT_RATIO","FONT_SIZE_RATIO","HEADER_FONT_SIZE_RATIO","LINE_HEIGHT","CAP_VALUE","innerTextGetter","ratio","round","NestedBoxes","ratios","fillColors","textColors","content","firstSide","horizontal","classes","getInnerText","bufferRatio","textBufferRatio","defaultRatio","fontSizeRatio","headerFontSizeRatio","lineHeight","resolveOrientation","v1","v2","bufferDistance","textBufferDistance","side","x","y","fontSize","headerFontSize","rects","texts","connectingLines","i","innerText","colorOuter","colorInner","textColor","height","fill","below","className","style","txt","j","dy","nextSide","borderWidth","lineStyle","strokeWidth","strokeDasharray","line1","stroke","x1","x2","line2","totalX","totalY","totalXh","totalYh","classNames","viewBox","CustomTooltip","active","payload","isArea","payloads","sortBy","source","p","reverse","dataKey","includes","bounds","formattedBounds","Typography","xmlns","cx","cy","join","Charts","chartData","hiddenElements","setHiddenElements","React","useState","getLineChart","chart","ElementComponent","AreaChart","Area","LineChart","Line","formatter","getName","ResponsiveContainer","aspect","maxHeight","ComposedChart","margin","top","right","left","bottom","CartesianGrid","XAxis","YAxis","domain","undefined","tickFormatter","Tooltip","cursor","Legend","onClick","hiddenMap","cloneDeep","iconSize","iconType","some","hide","legendType","tooltipType","stackId","headers","TableCell","scope","rows","TableRow","component","TableContainer","Table","textAlign","TableHead","TableBody","getNested","theme","useTheme","isSm","useMediaQuery","breakpoints","down","up","el","val","title","getIntro","country","find","variant","fontWeight","lg","maxWidth","xl","mb","sm","display","mr","md","letterSpacing","textTransform","m","flexWrap","pt","justifyContent","xs","flexBasis","flexShrink","ml","pb","homeTexts","App","setIso","setChartData","setDictionary","setCountries","setChartIds","setChartConfigsMap","useEffect","then","term","definition","charts","getChartData","loading","Paper","elevation","color","fontFamily","typography","target","realIso","dangerouslySetInnerHTML","__html","px","mx","py","mt","palette","paper","columnCount","columnGap","sort","a","b","transformLink","createTheme","primary","main","secondary","ThemedApp","ThemeProvider","rootElement","document","getElementById","render","min","isFinite","toString","toPrecision","t","replaceAll"],"mappings":"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","file":"static/js/main.df6d2568.chunk.js","sourcesContent":["// export CONSTS\nexport const DISABLED = false;\nexport const TABLE_DELIN = \"__\";\nexport const MULTI_LINE_TEXT_DELIN = \"__\";\n\n// these are set in the home sheet for version controlability\nexport const CONFIGURABLE_GID_NAMES = [\"configs\", \"dictionary\", \"countries\"];\n// gids pointing to Sheet tabs\nexport const GID_MAP = {\n  home: \"0\",\n  // configs: null,\n  // dictionary: null,\n  // countries: null,\n};\n\n// now extracted from chart configs sheet\n// export const chartIds = [\n//   \"p95\",\n//   \"plhiv_diagnosis\",\n//   \"late_hiv\",\n//   \"plhiv_art\",\n//   \"new_art\",\n//   \"plhiv_suppressed\",\n//   \"testing_coverage\",\n//   \"key_populations\",\n//   \"policy_compliance\",\n// ];\n\n// MAPS TO SPREADSHEET COLUMN NAMES:\n// CONFIG SHEET - identifier fields (ie non-data fields)\nexport const CONFIG_FIELDS = {\n  chartId: \"chart_id\",\n  sourceGid: \"source_gid\",\n  element: \"element\",\n  displayName: \"display_name\",\n  capPercentage: \"cap_percentage\",\n  percentageDecimals: \"percentage_decimals\",\n  coarseIntegerFormatting: \"coarse_integer_formatting\",\n  colorOverride: \"color_override\",\n  chartType: \"chart_type\",\n  modelled: \"modelled\",\n  formula: \"formula\",\n  hidden: \"hidden\",\n  valueField: \"value_field\",\n  percentage: \"percentage\",\n};\n\n// DATA SHEETS - data fields (fields that configs can filter by)\nexport const DATA_FIELDS = {\n  // we preserve snake_case as a reminder that these are essentially database fields\n  country_iso_code: \"country_iso_code\",\n  sourceYear: \"source_year\",\n  value: \"value\",\n  year: \"year\",\n  indicator: \"indicator\",\n  indicator_description: \"indicator_description\",\n  sex: \"sex\",\n  age: \"age\",\n  population_segment: \"population_segment\",\n  population_sub_group: \"population_sub_group\",\n  country_name: \"country_name\",\n  area_name: \"area_name\",\n  geographic_scope: \"geographic_scope\",\n  value_upper: \"value_upper\",\n  value_lower: \"value_lower\",\n  value_comment: \"value_comment\",\n  unit_format: \"unit_format\",\n  source_organization: \"source_organization\",\n  source_database: \"source_database\",\n  source_display: \"source_display\",\n  notes: \"notes\",\n  modality: \"modality\",\n  modality_category: \"modality_category\",\n  import_file: \"import_file\",\n  import_timestamp: \"import_timestamp\",\n  row_id: \"row_id\",\n  suppressed: \"suppressed\",\n};\n\n// GENERATED FIELDS - fields we add for the app\nexport const GENERATED_FIELDS = {\n  // we use UPPER_CASE to distinguish from actual \"database\" fields from the Sheet\n  DISPLAY_NAME: \"DISPLAY_NAME\",\n  DISPLAY_VALUE: \"DISPLAY_VALUE\",\n  DISPLAY_VALUE_LOWER: `DISPLAY_${DATA_FIELDS.value_lower.toUpperCase()}`,\n  DISPLAY_VALUE_UPPER: `DISPLAY_${DATA_FIELDS.value_upper.toUpperCase()}`,\n};\n","import {\n  tomato,\n  red,\n  crimson,\n  pink,\n  plum,\n  purple,\n  violet,\n  indigo,\n  blue,\n  cyan,\n  teal,\n  green,\n  grass,\n  orange,\n  brown,\n  sky,\n  mint,\n  lime,\n  yellow,\n  amber,\n  gray,\n  mauve,\n  slate,\n  sage,\n  olive,\n  sand,\n  gold,\n  bronze,\n} from \"@radix-ui/colors\";\n\n// keep in sync with index.html background\nexport const themePrimary = sand;\nexport const themeSecondary = indigo;\nexport const headerColor = gold;\nexport const coreColors = [orange, grass, plum];\nexport const altColors = [tomato, indigo, gold];\nexport const alt2Colors = [sky, brown, violet, sand];\nexport const colorGroups = [coreColors, altColors, alt2Colors];\n// these intensities correspond to the radix index to use\nexport const fillIntensity = 8;\nexport const strokeIntensity = 11;\n\nexport const radColors = [\n  tomato,\n  red,\n  crimson,\n  pink,\n  plum,\n  purple,\n  violet,\n  indigo,\n  blue,\n  cyan,\n  teal,\n  green,\n  grass,\n  orange,\n  brown,\n  sky,\n  mint,\n  lime,\n  yellow,\n  amber,\n  gray,\n  mauve,\n  slate,\n  sage,\n  olive,\n  sand,\n  gold,\n  bronze,\n];\n\nexport const getRC = (radColor, idx) => {\n  // return custom colors as-is\n  if (typeof radColor === \"string\") return radColor;\n  const c1 = Object.keys(radColor)[0];\n  const c = c1.replace(/\\d/, \"\") + idx;\n  return radColor[c];\n};\n","import _ from \"lodash\";\nimport { colorGroups } from \"../consts/colors\";\nimport {\n  CONFIG_FIELDS as C,\n  DATA_FIELDS as D,\n  GENERATED_FIELDS as G,\n} from \"../consts/data\";\nimport { capValue, displayNumber, displayPercent } from \"./display\";\n\n// functions to test whether a row matches a filter for special Sheet cell input values\nconst SPECIAL_FILTERS_MAP = {\n  _NONE_: _.negate(_.identity), // cells only included if empty\n  _SOMETHING_: _.identity, // cells only included if not empty\n  _ANY_: _.stubTrue, // allow any cell value (to overwrite broader filter)\n};\n// default function to test whether a row matches a filter\nconst defaultCompFn = (cellVal, filterVal) =>\n  cellVal.toLowerCase() === filterVal.toLowerCase();\n\n// HELPERS\nexport const getUrl = (gid) =>\n  `https://docs.google.com/spreadsheets/d/e/2PACX-1vSAEOXOt5aHDcb35lpCsSO5AvHTZPplXHrHGaIXTJjCtW_B96D0MOItWZLGv1j4lagTxnuVClms6M0X/pub?gid=${gid}&single=true&output=csv`;\n\nexport const configParser = (row) => {\n  if (!row[C.chartId]) return;\n  delete row[\"\"];\n\n  _.each(row, (value, key) => {\n    // remove k/v pair for actually empty values\n    if (value === \"\") delete row[key];\n    // turn \"null\" in sheet into \"\" values\n    // else row[key] = value === \"null\" ? \"\" : value;\n  });\n\n  return row;\n};\n\nexport const filterByCountryGenerator = (selectedIso) => {\n  return (row) => (row[D.country_iso_code] === selectedIso ? row : null);\n};\n\n// determine actual chart elements from chart config\nexport const getElements = (chartConfig) =>\n  Object.keys(chartConfig).filter((k) => k !== \"all\" && !k.startsWith(\"_key_\"));\n\n// get setting from element, else chart, else global\nexport const getSetting = ({\n  element = \"all\",\n  chartConfigsMap,\n  field,\n  chartId = \"all\",\n}) =>\n  _.get(chartConfigsMap, [chartId, element, 0, field]) ||\n  _.get(chartConfigsMap, [chartId, \"all\", 0, field]) ||\n  _.get(chartConfigsMap, [\"all\", 0, field]);\n\n// omit element to get chart-wide setting\nexport const getField = ({ element = \"all\", chartConfig, field }) =>\n  _.get(chartConfig, [element, 0, field]);\n\n// omit element to get chart-wide setting\nexport const getFieldBoolean = ({ element = \"all\", chartConfig, field }) =>\n  !!getField({ element, chartConfig, field });\n\nexport const getFormula = ({ element, chartConfig }) =>\n  getField({ element, chartConfig, field: C.formula });\n\nexport const getBounds = (row = {}) => {\n  const { [D.value_lower]: vLower, [D.value_upper]: vUpper } = row;\n  if (!parseFloat(vLower) || !parseFloat(vUpper)) return;\n  return [parseFloat(vLower), parseFloat(vUpper)];\n};\n\n// determine a chart's colors based on its override settings\nexport const getColors = ({\n  chartSettings,\n  chartConfig,\n  chartElements: visibleElements,\n}) => {\n  // chart-wide override determines which color group to use\n  let groupIdx = parseInt(Math.abs(_.get(chartSettings, C.colorOverride)));\n  groupIdx = ((groupIdx || 1) - 1) % colorGroups.length;\n\n  const baseColors = colorGroups[groupIdx];\n  const colors = visibleElements.map((element, idx) => {\n    // element-specific overrides trump the base group color\n    const override = getField({ chartConfig, element, field: C.colorOverride });\n    return override || baseColors[idx % baseColors.length];\n  });\n\n  const type = _.get(chartSettings, C.chartType);\n  // nested boxes charts need one more color than they have elements\n  if (type === \"nested\")\n    colors.push(baseColors[visibleElements.length % baseColors.length]);\n\n  return colors;\n};\n\n// turn \"[2018-2020]\" into [2018, 2019, 2020]\nexport const transformYearRange = (range) => {\n  const regex = /\\[(\\d+)-(\\d+)\\]/;\n  const result = regex.exec(range);\n  if (!result || !result.length > 1) return [];\n  const y1 = parseInt(result[1]);\n  const y2 = parseInt(result[2]);\n  return _.range(y1, y2 + 1).map(String);\n};\n\n// derive a row filter of type { sex: \"males\", age: \"15+\" }\nexport const getFilter = ({\n  chartId,\n  element,\n  year = null,\n  selectedIso,\n  chartConfigsMap,\n}) => {\n  // filter applied to all charts\n  const allChartsFilter = _.get(chartConfigsMap, \"all[0]\", {});\n  // filter applied to all elements within this chart\n  const allElementsFilter = _.get(chartConfigsMap, [chartId, \"all\", 0], {});\n  // filter applied to this element\n  // (backupFilters may be used for source prioritization)\n  const [elementFilter, ...backupFilters] = _.get(\n    chartConfigsMap,\n    [chartId, element],\n    [{}]\n  );\n  // console.log(elementFilter);\n\n  const filter = {\n    ...allChartsFilter,\n    ...allElementsFilter,\n    ...elementFilter,\n    selectedIso,\n  };\n  if (!!year) filter.year = year;\n  return filter;\n};\n\n// find appropriate row using filter\nexport const getRow = ({ filter, chartSourceData }) => {\n  const matchingRows = _.filter(chartSourceData, (row) => {\n    return _.every(filter, (filterVal, field) => {\n      // only filter by data sheet fields\n      if (!D[field]) return true;\n\n      const cellVal = row[field] || \"\";\n      let comparisonFn = SPECIAL_FILTERS_MAP[filterVal] || defaultCompFn;\n\n      // if (!row[field]) return !filterVal;\n      return !!comparisonFn(cellVal, filterVal);\n    });\n  });\n\n  // find highest year, use source year to break ties\n  return _.maxBy(matchingRows, (r) => {\n    const y = Number(_.get(r, D.year, 0));\n    const sy = Number(_.get(r, D.sourceYear, 0));\n    return y + sy / 10000;\n  });\n};\n\n// find/create data point to use for a line point or table cell\nexport const getDataPoint = ({\n  chartId,\n  element,\n  year = null,\n  selectedIso,\n  chartConfigsMap,\n  chartSourceData,\n  // valueParser = _.identity,\n}) => {\n  const filter = getFilter({\n    chartId,\n    element,\n    year,\n    selectedIso,\n    chartConfigsMap,\n    chartSourceData,\n  });\n\n  const row = getRow({ filter, chartSourceData });\n\n  // usually we care about \"value\", but sometimes \"value_comment\"\n  const valueField = _.get(filter, C.valueField, D.value);\n  let value = _.get(row, valueField, null);\n\n  if (!row || !value) return {};\n\n  // add display name for elements appearance in legend, tooltip\n  const displayName = getField({\n    element,\n    chartConfig: chartConfigsMap[chartId],\n    field: C.displayName,\n  });\n  displayName && _.set(row, G.DISPLAY_NAME, displayName);\n\n  // assume that value_comment (or other non-value) field is for non-numeric column\n  if (valueField && valueField !== D.value) return { row, value };\n\n  // assume that value holds numeric data, proceed to process\n  return capAndFormat({ row, value, chartConfigsMap, chartId, element });\n};\n\n// mutates its row input!\n// applies caps and display formatting settings to numeric row/values\nexport const capAndFormat = ({\n  row,\n  value,\n  chartConfigsMap,\n  chartId,\n  element,\n}) => {\n  let displayValue = value;\n\n  const isPercentage = getFieldBoolean({\n    chartConfig: chartConfigsMap[chartId],\n    field: C.percentage,\n  });\n\n  if (isPercentage) {\n    const cap = getSetting({\n      chartConfigsMap,\n      chartId,\n      element,\n      field: C.capPercentage,\n    });\n    const decimals = getSetting({\n      chartConfigsMap,\n      chartId,\n      element,\n      field: C.percentageDecimals,\n    });\n\n    // value = value && valueParser(value);\n    const options = { cap, decimals };\n    // be sure to capture display value BEFORE capping, so it includes >\n    displayValue = displayPercent(value, options);\n    value = capValue(value, options);\n    // overwriting\n    capValue && _.set(row, D.value, value);\n\n    [D.value_lower, D.value_upper].forEach((F) => {\n      const v = _.get(row, F);\n\n      // formatted capped val for tooltips\n      v && _.set(row, `DISPLAY_${F.toUpperCase()}`, displayPercent(v, options));\n\n      // capped val for plotting\n      const cv = v && capValue(v, options);\n      cv && _.set(row, F, cv);\n    });\n  } else {\n    // is integer\n    const coarseFormatting = !!getSetting({\n      chartConfigsMap,\n      chartId,\n      element,\n      field: C.coarseIntegerFormatting,\n    });\n    displayValue = displayNumber(value, { coarseFormatting });\n\n    [D.value_lower, D.value_upper].forEach((F) => {\n      let v = _.get(row, F);\n      // formatted value for tooltips\n      v && _.set(row, `DISPLAY_${F.toUpperCase()}`, displayNumber(v));\n      // v && _.set(row, F, v);\n    });\n  }\n\n  // formatted value for tooltips\n  displayValue && _.set(row, G.DISPLAY_VALUE, displayValue);\n\n  return { row, value };\n};\n\n// create derived data point (from other found points) using formula provided in Sheet\nexport const getCalculatedDataPoint = ({\n  chartConfigsMap,\n  element,\n  dataPoints,\n  chartId,\n}) => {\n  const chartConfig = chartConfigsMap[chartId];\n  const rawFormula = getFormula({ element, chartConfig });\n  let convertedFormula = rawFormula;\n\n  // where the *magic* happens: formula is converted from the\n  // string provided in the Sheet to an actual mathematical\n  // expression by swapping element names for their values\n  // e.g.:  total_hiv-aware  becomes  7843-384\n  _.each(dataPoints, (value, key) => {\n    convertedFormula = convertedFormula.replace(key, value);\n  });\n\n  let result = null;\n  // attempt to evaluate the resulting expression\n  try {\n    result = eval(convertedFormula);\n  } catch (error) {\n    console.warn(`cannot evaluate ${rawFormula} (${convertedFormula})`);\n    return { value: null };\n  }\n\n  // only allow numbers & arith operators (otherwise eg null will evaluate to 0)\n  if (!/^[\\d-+*\\/\\.]+$/.test(convertedFormula) || !_.isNumber(result)) {\n    console.warn(`missing values for ${rawFormula} (${convertedFormula})`);\n    return { value: null };\n  }\n\n  // add display name for elements appearance in legend, tooltip\n  const displayName =\n    getField({\n      element,\n      chartConfig,\n      field: C.displayName,\n    }) || element;\n\n  // console.log(result);\n  return capAndFormat({\n    value: result,\n    row: { [G.DISPLAY_NAME]: displayName },\n    chartConfigsMap,\n    chartId,\n    element,\n  });\n};\n","import { csv } from \"d3-fetch\";\nimport _ from \"lodash\";\nimport {\n  CONFIG_FIELDS as C,\n  DATA_FIELDS as D,\n  GENERATED_FIELDS as G,\n  GID_MAP,\n  CONFIGURABLE_GID_NAMES,\n  TABLE_DELIN\n} from \"./consts/data\";\nimport {\n  getUrl,\n  configParser,\n  filterByCountryGenerator,\n  getElements,\n  getFieldBoolean,\n  getFormula,\n  getBounds,\n  getColors,\n  transformYearRange,\n  getDataPoint,\n  getCalculatedDataPoint,\n  getField\n} from \"./utils/data\";\n\n// ASYNC FETCHERS\nasync function setConfigGids() {\n  // return if already configured\n  if (CONFIGURABLE_GID_NAMES.every((name) => !!GID_MAP[name])) return;\n  const homeRows = await csv(getUrl(GID_MAP.home)).catch((e) => {\n    console.error(\"error in csv(getUrl(GID_MAP.home)): \", e);\n  });\n  CONFIGURABLE_GID_NAMES.forEach((name) => {\n    const lastConfiguredRow = _.findLast(homeRows, (r) => !!r[name]);\n    if (!lastConfiguredRow) {\n      console.error(\"No Sheet GID found for: \", name);\n      return;\n    }\n    GID_MAP[name] = lastConfiguredRow[name];\n  });\n}\n\nasync function getChartConfigs() {\n  const baseConfigs = await csv(getUrl(GID_MAP.configs), configParser).catch(\n    (e) => {\n      console.error(\"error in csv(getUrl(GID_MAP.configs), configParser): \", e);\n    }\n  );\n  const shaped = _.groupBy(baseConfigs, C.chartId);\n\n  const chartIds = _.uniqBy(baseConfigs, \"chart_id\")\n    .map((c) => c.chart_id)\n    .filter((id) => id !== \"all\");\n\n  const chartConfigsMap = _.mapValues(shaped, (configParams, name) => {\n    // wise?\n    if (name === \"all\") return configParams;\n    return _.groupBy(configParams, C.element);\n  });\n\n  _.each(chartConfigsMap, (configParams, name) => {\n    if (name === \"all\") return;\n    _.each(configParams, (elemDetails, elementName) => {\n      if (elementName === \"all\") return;\n    });\n  });\n\n  return { chartConfigsMap, chartIds };\n}\n\nasync function getAllDataFromTab(gid) {\n  // console.log(\"get data from\", gid);\n  return await csv(getUrl(gid)).catch((e) => {\n    console.error(\"error in getChartOrTable()): \", e);\n  });\n}\n\n// so we only request data from each tab once\n// after first dashboard load, countries should load instantly\nconst memoizedGetAllDataFromTab = _.memoize(getAllDataFromTab);\n\nasync function getCountryDataFromTab(gid, selectedIso) {\n  const allData = await memoizedGetAllDataFromTab(gid);\n\n  return allData.filter((d) => filterByCountryGenerator(selectedIso)(d));\n}\n\nasync function getCharts({ chartConfigsMap, chartIds, selectedIso }) {\n  return await Promise.all(\n    chartIds.map((chartId) =>\n      getChartOrTable({ chartConfigsMap, chartId, selectedIso })\n    )\n  ).catch((e) => {\n    console.error(\"error in getCharts(): \", e);\n  });\n}\n\nasync function getChartOrTable({ chartConfigsMap, chartId, selectedIso }) {\n  // if (\n  //   ![\n  // \"intro\",\n  // \"p95\",\n  // \"plhiv_diagnosis\",\n  // \"late_hiv\"\n  //   ].includes(chartId)\n  // )\n  // return;\n  // console.log(\"creating : \", chartId);\n  const chartConfig = chartConfigsMap[chartId];\n  // the chart settings are the values on the chart config where element === \"all\"\n  const chartSettings = _.get(chartConfig, \"all[0]\");\n\n  if (!chartConfig || !chartSettings || !chartSettings[C.sourceGid]) {\n    console.warn(\"skipping chart: \", chartId);\n    return null;\n  }\n  const chartSourceData = await getCountryDataFromTab(\n    chartSettings[C.sourceGid],\n    selectedIso\n  );\n\n  const getterMap = {\n    table: getTable,\n    text: getText\n    // nested: getNested, // uses chart\n  };\n\n  const getter = _.get(getterMap, chartSettings[C.chartType], getChart);\n\n  return getter({\n    chartId,\n    chartSettings,\n    chartConfigsMap,\n    chartSourceData,\n    selectedIso\n  });\n}\n\nfunction getText({\n  chartId,\n  chartSettings,\n  chartConfigsMap,\n  chartSourceData,\n  selectedIso\n}) {\n  console.log(\n    chartId,\n    chartSettings,\n    chartConfigsMap,\n    chartSourceData,\n    selectedIso\n  );\n\n  const elements = getElements(chartConfigsMap[chartId]);\n  const textValues = {};\n  _.each(elements, (element) => {\n    const { row, value } = getDataPoint({\n      chartId,\n      element,\n      selectedIso,\n      chartConfigsMap,\n      chartSourceData\n      // valueParser: isPercentage\n    });\n    textValues[element] = value;\n    textValues[`${element}_row`] = row;\n  });\n\n  return {\n    textValues,\n    chartId,\n    countryIso: selectedIso,\n    elements,\n    type: _.get(chartSettings, C.chartType),\n    name: _.get(chartSettings, C.displayName, chartId)\n  };\n}\n\nfunction getTable({\n  chartId,\n  chartSettings,\n  chartConfigsMap,\n  chartSourceData,\n  selectedIso\n}) {\n  const chartConfig = chartConfigsMap[chartId];\n\n  const elements = getElements(chartConfig);\n  const dataPoints = {};\n  // add non-calculated points\n  const isPercentage = getFieldBoolean({\n    chartConfig,\n    field: C.percentage\n  });\n  _.each(elements, (element) => {\n    const { row, value } = getDataPoint({\n      chartId,\n      element,\n      selectedIso,\n      chartConfigsMap,\n      chartSourceData\n      // valueParser: isPercentage\n    });\n    dataPoints[element] = value;\n    dataPoints[element + \"_row\"] = row;\n  });\n\n  const rowNames = _.uniq(elements.map((elem) => elem.split(TABLE_DELIN)[0]));\n  const colNames = _.uniq(elements.map((elem) => elem.split(TABLE_DELIN)[1]));\n\n  const data = rowNames.map((rn) => ({\n    row: _.get(chartConfig, [`_key_${rn}`, 0, C.displayName], rn),\n    values: colNames.map((cn) => ({\n      column: _.get(chartConfig, [`_key_${cn}`, 0, C.displayName], cn),\n      value: _.get(dataPoints, `${rn}${TABLE_DELIN}${cn}`),\n      sheetRow: _.get(dataPoints, `${rn}${TABLE_DELIN}${cn}_row`)\n    }))\n  }));\n  const chart = {\n    data,\n    chartId,\n    countryIso: selectedIso,\n    elements: elements,\n    isPercentage,\n    type: _.get(chartSettings, C.chartType),\n    name: _.get(chartSettings, C.displayName, chartId)\n  };\n\n  return chart;\n}\n\nfunction getChart({\n  chartId,\n  chartSettings,\n  chartConfigsMap,\n  chartSourceData,\n  selectedIso\n}) {\n  const chartConfig = chartConfigsMap[chartId];\n\n  const elements = getElements(chartConfig);\n  const visibleElements = elements.filter(\n    (element) => !getFieldBoolean({ element, chartConfig, field: C.hidden })\n  );\n  // console.log(elements);\n\n  // NOTE: currently all charts range over years\n  const year_range = _.get(chartConfig, [\"all\", 0, D.year]);\n  const isTimeseries = year_range;\n  const years_arr = isTimeseries ? transformYearRange(year_range) : [\"all\"];\n  // console.log(years_arr);\n\n  // getchartdata per element\n  const data = _.map(years_arr, (year) => {\n    const dataPoints = {};\n\n    // add non-calculated points\n    _.each(elements, (element) => {\n      if (!!getFormula({ element, chartConfig })) return null;\n      const { row, value } = getDataPoint({\n        chartId,\n        element,\n        year: isTimeseries ? year : null,\n        selectedIso,\n        chartConfigsMap,\n        chartSourceData\n      });\n      dataPoints[element] = value;\n      dataPoints[element + \"_row\"] = row;\n      dataPoints[element + \"_bounds\"] = getBounds(row);\n    });\n\n    // add calculated points (now that non-calculated constituents have values)\n    _.each(elements, (element) => {\n      if (!getFormula({ element, chartConfig })) return null;\n      const { row, value } = getCalculatedDataPoint({\n        chartId,\n        element,\n        chartConfigsMap,\n        dataPoints\n      });\n      dataPoints[element] = value;\n      dataPoints[element + \"_row\"] = row;\n    });\n\n    // delete elements used only as constituents in calculations\n    _.each(elements, (element) => {\n      if (getFieldBoolean({ element, chartConfig, field: C.hidden })) {\n        // console.log(\"deleting: \", element);\n        delete dataPoints[element];\n      }\n    });\n    dataPoints.name = year;\n    // console.log(dataPoints);\n    return dataPoints;\n  });\n\n  const elementNameMap = {};\n  _.each(\n    visibleElements,\n    (element) =>\n      (elementNameMap[element] = getField({\n        element,\n        chartConfig: chartConfigsMap[chartId],\n        field: C.displayName\n      }))\n  );\n\n  const colors = getColors({\n    chartSettings,\n    chartConfig,\n    chartElements: visibleElements\n  });\n\n  const chart = {\n    data: isTimeseries ? data : data[0],\n    chartId,\n    countryIso: selectedIso,\n    elements: visibleElements,\n    elementNameMap,\n    colors,\n    isPercentage: getFieldBoolean({\n      chartConfig,\n      field: C.percentage\n    }),\n    type: _.get(chartSettings, C.chartType),\n    name: _.get(chartSettings, C.displayName, chartId)\n  };\n\n  return chart;\n}\n// ___ END ASYNC FETCHERS _____\n\n// MAIN FUNCTIONS\n\n/** SITE DATA - runs once on site load */\nexport async function getSiteData() {\n  // if (DISABLED) return [];\n  // CONFIGURE GIDS MAP\n  await setConfigGids().catch((e) => {\n    console.error(\"error in setConfigGids(): \", e);\n  });\n\n  // GRAB DICTIONARY\n  const dictionary = await csv(getUrl(GID_MAP.dictionary)).catch((e) =>\n    console.error(\"error in getDictionary: \", e)\n  );\n\n  // GRAB DICTIONARY\n  const countries = await csv(getUrl(GID_MAP.countries)).catch((e) =>\n    console.error(\"error in getcountries: \", e)\n  );\n\n  // GRAB CONFIGS\n  const { chartConfigsMap, chartIds } = await getChartConfigs().catch((e) =>\n    console.error(\"error in getChartConfigs(): \", e)\n  );\n  console.log(\"@@@ ALL CONFIGS: \");\n  console.log(chartConfigsMap);\n\n  return { dictionary, countries, chartConfigsMap, chartIds };\n}\n\n/** CREATE CHARTS - whenever selected country changes */\nexport async function getChartData({ chartConfigsMap, chartIds, selectedIso }) {\n  const charts = await getCharts({\n    chartConfigsMap,\n    chartIds,\n    selectedIso\n  }).catch((e) => {\n    console.error(\"error in getCharts(selectedIso): \", e);\n  });\n\n  return { charts };\n}\n","import React from \"react\";\nimport { FormControl, InputLabel, MenuItem, Select } from \"@mui/material\";\n\nexport const CountrySelect = ({\n  handleCountryChange,\n  selectedIso,\n  countries,\n}) => {\n  return (\n    <FormControl sx={{ width: 300, marginTop: 1, marginBottom: 1 }}>\n      <InputLabel id=\"country\">Country</InputLabel>\n      <Select\n        labelId=\"country\"\n        id=\"country-select\"\n        value={selectedIso || \"home\"}\n        label=\"Country\"\n        onChange={handleCountryChange}\n      >\n        <MenuItem value={\"home\"}>Select a country...</MenuItem>\n        {countries.map(({ iso, name }) => (\n          <MenuItem key={iso} value={iso}>\n            {name}\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport AppBar from \"@mui/material/AppBar\";\nimport Box from \"@mui/material/Box\";\nimport Toolbar from \"@mui/material/Toolbar\";\nimport { CountrySelect } from \"./CountrySelect\";\nimport { getRC, headerColor } from \"../consts/colors\";\n\nexport const Header = ({ selectedIso, handleCountryChange, countries }) => {\n  return (\n    <Box sx={{ flexGrow: 1 }}>\n      <AppBar position=\"fixed\" sx={{ background: getRC(headerColor, 7) }}>\n        <Toolbar>\n          <CountrySelect\n            countries={countries}\n            handleCountryChange={handleCountryChange}\n            selectedIso={selectedIso}\n          />\n        </Toolbar>\n      </AppBar>\n    </Box>\n  );\n};\n","import React from \"react\";\n// import './styles.css'\nimport _ from \"lodash\";\n\nconst BUFFER_RATIO = 0.2;\nconst TEXT_BUFFER_RATIO = 0.1;\nconst DEFAULT_RATIO = 0.7;\nconst FONT_SIZE_RATIO = 0.1;\nconst HEADER_FONT_SIZE_RATIO = 0.16;\nconst LINE_HEIGHT = 1.1;\nconst CAP_VALUE = null;\n\nconst innerTextGetter = (ratio, { capValue }) => {\n  return !ratio\n    ? \"Unknown %\"\n    : capValue && ratio > capValue\n    ? `>${capValue * 100}%`\n    : `${Math.round(ratio * 100)}%`;\n};\n\nconst NestedBoxes = ({\n  ratios,\n  fillColors,\n  textColors,\n  content,\n  firstSide = 100,\n  horizontal = true,\n  classes = \"\",\n  getInnerText = innerTextGetter,\n  bufferRatio = BUFFER_RATIO,\n  textBufferRatio = TEXT_BUFFER_RATIO,\n  defaultRatio = DEFAULT_RATIO,\n  capValue = CAP_VALUE,\n  fontSizeRatio = FONT_SIZE_RATIO,\n  headerFontSizeRatio = HEADER_FONT_SIZE_RATIO,\n  lineHeight = LINE_HEIGHT,\n}) => {\n  const resolveOrientation = (v1, v2) => {\n    return horizontal ? v2 : v1;\n  };\n\n  const bufferDistance = firstSide * (1 + bufferRatio);\n  const textBufferDistance = firstSide * (1 + textBufferRatio);\n\n  let side = firstSide;\n  let x = 0;\n  let y = 0;\n\n  const fontSize = firstSide * fontSizeRatio;\n  const headerFontSize = firstSide * headerFontSizeRatio;\n\n  const rects = [];\n  const texts = [];\n  const connectingLines = [];\n\n  _.each(ratios, (ratio, i) => {\n    // const noRatio = !ratio\n    const innerText = getInnerText(ratio, { capValue });\n    ratio = ratio || defaultRatio;\n\n    if (capValue && ratio > capValue) {\n      ratio = capValue;\n    }\n\n    const colorOuter = fillColors[i];\n    const colorInner = fillColors[i + 1];\n    const textColor = textColors[i + 1];\n\n    // add outer box\n    rects.push(\n      <rect\n        x={resolveOrientation(x, y)}\n        y={resolveOrientation(y, x)}\n        width={side}\n        height={side}\n        fill={colorOuter}\n      />\n    );\n\n    const { below = [] } = _.get(content, i, {});\n    const text = (\n      <text\n        fontSize={fontSize}\n        // set the initial y for all tspans\n        // the x we set on each individually so they don't try to go one after another\n        y={resolveOrientation(y + fontSize, textBufferDistance + fontSize)}\n      >\n        <tspan\n          className=\"percent\"\n          x={resolveOrientation(textBufferDistance, y)}\n          style={{ fill: textColor, fontSize: headerFontSize }}\n        >\n          {innerText}\n        </tspan>\n        {below.map((txt, j) => (\n          <tspan\n            key={i + j}\n            className=\"description\"\n            x={resolveOrientation(textBufferDistance, y)}\n            dy={fontSize * lineHeight}\n          >\n            {txt}\n          </tspan>\n        ))}\n      </text>\n    );\n    texts.push(text);\n\n    let nextSide = side * ratio;\n    const borderWidth = (side - nextSide) / 2; // the amount of outer box that shows around the inner box\n    x += borderWidth;\n    y += borderWidth;\n    side = nextSide;\n\n    // add inner box\n    rects.push(\n      <rect\n        x={resolveOrientation(x, y)}\n        y={resolveOrientation(y, x)}\n        width={side}\n        height={side}\n        fill={colorInner}\n      />\n    );\n\n    if (i === ratios.length - 1) {\n      return;\n    }\n\n    const lineStyle = {\n      strokeWidth: \".4\",\n      strokeDasharray: \".8 1\",\n    };\n    // if there's another box coming, add lines to it\n    const line1 = (\n      <line\n        style={lineStyle}\n        stroke={colorInner}\n        x1={resolveOrientation(x, y + side)}\n        x2={resolveOrientation(x, y + bufferDistance)}\n        y1={resolveOrientation(y + side, x)}\n        y2={resolveOrientation(y + bufferDistance, x)}\n      />\n    );\n    const line2 = (\n      <line\n        style={lineStyle}\n        stroke={colorInner}\n        x1={resolveOrientation(x + side, y + side)}\n        x2={resolveOrientation(x + side, y + bufferDistance)}\n        y1={resolveOrientation(y + side, x + side)}\n        y2={resolveOrientation(y + bufferDistance, x + side)}\n      />\n    );\n    connectingLines.push(line1, line2);\n\n    // and shift down for the next\n    y += bufferDistance;\n  });\n\n  const totalX = firstSide + (textBufferDistance + firstSide); // (text width)\n  const totalY = y + firstSide;\n  const totalXh = y + bufferDistance;\n  const totalYh = textBufferDistance + (headerFontSize + fontSize * 5); // (text height)\n\n  const classNames = \"nested-boxes \" + classes;\n\n  return (\n    <div className={classNames}>\n      {/* <p className='title'>{title}</p> */}\n      <svg\n        viewBox={`0 -2 ${resolveOrientation(\n          totalX,\n          totalXh\n        )} ${resolveOrientation(totalY, totalYh)}`}\n      >\n        {rects}\n        {texts}\n        {connectingLines}\n      </svg>\n    </div>\n  );\n};\n\nexport default NestedBoxes;\n","import React from \"react\";\nimport _ from \"lodash\";\nimport Typography from \"@mui/material/Typography\";\nimport {\n  AreaChart,\n  Area,\n  ComposedChart,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  LineChart,\n  Line,\n  ResponsiveContainer,\n  Legend,\n} from \"recharts\";\nimport { Box, useTheme } from \"@mui/system\";\nimport Table from \"@mui/material/Table\";\nimport TableBody from \"@mui/material/TableBody\";\nimport TableCell from \"@mui/material/TableCell\";\nimport TableContainer from \"@mui/material/TableContainer\";\nimport TableHead from \"@mui/material/TableHead\";\nimport TableRow from \"@mui/material/TableRow\";\nimport NestedBoxes from \"./NestedBoxes\";\nimport {\n  getRC,\n  strokeIntensity,\n  fillIntensity,\n  themePrimary,\n  themeSecondary,\n} from \"../consts/colors\";\nimport { displayNumber, displayPercent } from \"../utils/display\";\nimport {\n  CONFIG_FIELDS as C,\n  DATA_FIELDS as D,\n  GENERATED_FIELDS as G,\n  MULTI_LINE_TEXT_DELIN,\n} from \"../consts/data\";\nimport { useMediaQuery } from \"@mui/material\";\n\n// TODO: standardize / create sane system for styles\n// TODO: CLEAN / EXTRACt this and other components\nconst CustomTooltip = ({ active, payload, label, isArea }) => {\n  if (active && payload && payload.length) {\n    // if lines, stack legend to match line height order\n    const payloads = isArea ? payload : _.sortBy(payload, \"value\");\n\n    let source = null;\n    return (\n      <Box sx={{ background: \"white\", p: 2 }} className=\"custom-tooltip\">\n        <strong className=\"label\">{label}</strong>\n        {payloads.reverse().map((p) => {\n          if (p.dataKey.includes(\"_bounds\")) return;\n\n          const bounds = _.get(p.payload, p.dataKey + \"_bounds\", []);\n          const formattedBounds = [D.value_lower, D.value_upper].map((F, i) =>\n            _.get(\n              p.payload,\n              [p.dataKey + \"_row\", `DISPLAY_${F.toUpperCase()}`],\n              bounds[i]\n            )\n          );\n\n          const v = _.get(\n            p.payload,\n            [p.dataKey + \"_row\", G.DISPLAY_VALUE],\n            p.value\n          );\n          // console.log(\"$$$\", v, p.payload);\n\n          // use first source\n          source =\n            source ||\n            _.get(p.payload, [p.dataKey + \"_row\", D.source_display]) ||\n            _.get(p.payload, [p.dataKey + \"_row\", D.source_database]);\n\n          return (\n            <Typography key={p.dataKey}>\n              <svg\n                width=\"18\"\n                viewBox=\"0 0 160 100\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <circle cx=\"50\" cy=\"50\" r=\"50\" fill={p.fill}></circle>\n              </svg>\n              {p.name}: {v}{\" \"}\n              {!!bounds.length && `(${formattedBounds.join(\" - \")})`}\n            </Typography>\n          );\n        })}\n        {source && (\n          <>\n            <br />\n            <u>Source</u>: {source}\n          </>\n        )}\n      </Box>\n    );\n  } else return null;\n};\n\nexport const Charts = ({ selectedIso, chartData, countries }) => {\n  const [hiddenElements, setHiddenElements] = React.useState({});\n\n  const getLineChart = (chart) => {\n    const {\n      data,\n      chartId,\n      elements,\n      type,\n      isPercentage,\n      colors,\n      elementNameMap,\n    } = chart;\n    const isArea = type === \"area\";\n    const [, ElementComponent] = isArea ? [AreaChart, Area] : [LineChart, Line];\n\n    const formatter = isPercentage\n      ? (v) => displayPercent(v)\n      : (v) => displayNumber(v);\n\n    const getName = (elem) => _.get(elementNameMap, elem, elem);\n\n    const onLegendClick = (e) => {\n      console.log(e.dataKey);\n      const hiddenMap = _.cloneDeep(hiddenElements);\n      const hidden = _.get(hiddenMap, [chartId, e.dataKey], false);\n      _.set(hiddenMap, [chartId, e.dataKey], !hidden);\n      setHiddenElements(hiddenMap);\n    };\n\n    return (\n      <ResponsiveContainer\n        // needed for proper resizing https://github.com/recharts/recharts/issues/172#issuecomment-307858843\n        width=\"99%\"\n        aspect={1.25}\n        // height={400}\n        maxHeight={400}\n        // maxWidth={600}\n      >\n        <ComposedChart\n          // width={500}\n          // height={400}\n          data={data}\n          margin={{\n            top: 30,\n            right: 30,\n            left: 0,\n            bottom: 0,\n          }}\n        >\n          <CartesianGrid strokeDasharray=\"3 3\" />\n          <XAxis dataKey=\"name\" />\n          <YAxis\n            width={80}\n            domain={isPercentage ? [0, 100] : undefined}\n            tickFormatter={formatter}\n          />\n          <Tooltip\n            cursor={{ stroke: getRC(themeSecondary, 10), strokeWidth: 1 }}\n            content={<CustomTooltip isArea={isArea} />}\n          />\n          <Legend\n            onClick={onLegendClick}\n            iconSize={isArea ? 8 : 14}\n            iconType={isArea && \"circle\"}\n          />\n          {elements.map((elem, i) => {\n            const isBounded =\n              !isArea &&\n              _.some(data, (d) => _.get(d, [elem + \"_bounds\"], []).length);\n            if (!isBounded) return null;\n            return (\n              <Area\n                key={i + \"_b\"}\n                // type=\"step\"\n                dataKey={elem + \"_bounds\"}\n                hide={_.get(hiddenElements, [chartId, elem], false)}\n                // stackId={i + 1}\n                legendType=\"none\"\n                tooltipType=\"none\"\n                stroke={getRC(colors[i], strokeIntensity - 3)}\n                fill={getRC(colors[i], fillIntensity - 3)}\n              />\n            );\n          })}\n          {elements.map((elem, i) => (\n            <ElementComponent\n              key={i}\n              // type=\"monotone\"\n              // dataBounds={_.get(elem, [elem + \"_bounds\"], [])}\n              dataKey={elem}\n              name={getName(elem)}\n              hide={_.get(hiddenElements, [chartId, elem], false)}\n              stackId={isArea ? 1 : i + 1000}\n              stroke={getRC(colors[i], strokeIntensity)}\n              fill={getRC(colors[i], fillIntensity)}\n            />\n          ))}\n        </ComposedChart>\n      </ResponsiveContainer>\n    );\n  };\n\n  const getTable = (chart) => {\n    const { data } = chart;\n\n    const headers = data[0][\"values\"].map(({ column }) => (\n      <TableCell scope=\"col\" key={column}>\n        {column}\n      </TableCell>\n    ));\n\n    const rows = data.map(({ row, values }) => (\n      <TableRow key={row}>\n        <TableCell scope=\"row\" component=\"th\">\n          {row}\n        </TableCell>\n        {values.map(({ value, column, sheetRow }) => (\n          <TableCell key={column}>\n            {_.get(sheetRow, G.DISPLAY_VALUE, value) || \"N/A\"}\n            {/* {(value && (sheetRow && sheetRow[G.DISPLAY_VALUE] || value)) || \"N/A\"} */}\n          </TableCell>\n        ))}\n      </TableRow>\n    ));\n\n    return (\n      <ResponsiveContainer>\n        <TableContainer>\n          <Table\n            sx={{\n              \"& tbody tr:nth-of-type(odd)\": {\n                background: getRC(themePrimary, 6),\n              },\n              \"& td, & thead th\": {\n                textAlign: \"right\",\n              },\n            }}\n          >\n            <TableHead>\n              <TableRow>\n                <TableCell scope=\"col\"></TableCell>\n                {headers}\n              </TableRow>\n            </TableHead>\n            <TableBody>{rows}</TableBody>\n          </Table>\n        </TableContainer>\n      </ResponsiveContainer>\n    );\n  };\n\n  const getNested = (chart) => {\n    const theme = useTheme();\n    const isSm = useMediaQuery(theme.breakpoints.down(\"sm\"));\n    const isXl = useMediaQuery(theme.breakpoints.up(\"md\"));\n    const { data, elements, colors, elementNameMap } = chart;\n    const xl = false;\n    // console.log(radColors);\n    const ratios = elements.map((el) => {\n      const val = data[el];\n      return val && val / 100;\n    });\n    const content = elements.map((el) => {\n      const text = elementNameMap[el];\n      return { below: text.split(MULTI_LINE_TEXT_DELIN) };\n    });\n    // console.log(ratios);\n    return (\n      <>\n        <NestedBoxes\n          // circle={true}\n          // classes={xl ? \"xl\" : \"\"}\n          title={\"title\"}\n          bufferRatio={!isSm ? 0.8 : 0.2}\n          lineHeight={!isSm ? 1.4 : 1.1}\n          textBufferRatio={0.2}\n          firstSide={20}\n          horizontal={!isSm}\n          ratios={ratios}\n          fillColors={colors.map((c) => getRC(c, 8))}\n          textColors={colors.map((c) => getRC(c, 9))}\n          content={content}\n        />\n        <br />\n      </>\n    );\n  };\n\n  const getIntro = (chart) => {\n    const country = countries.find((c) => c.iso === selectedIso);\n    return (\n      <>\n        <Typography\n          variant=\"h2\"\n          component=\"h1\"\n          sx={{\n            fontWeight: 500,\n            lineHeight: 1,\n            fontSize: { lg: \"6rem\" },\n            maxWidth: { lg: 760, xl: \"100%\" },\n            mb: { sm: 1, lg: 2 },\n          }}\n        >\n          {country && country.name}\n        </Typography>\n        <Box\n          sx={{\n            display: { sm: \"flex\" },\n            \"& dl:not(:last-child)\": { mr: { sm: 4, md: 10 } },\n            \"& dt h2\": {\n              fontWeight: 100,\n              letterSpacing: \".8px\",\n              textTransform: \"uppercase\",\n            },\n            \"& dt, dd\": { m: 0 },\n          }}\n        >\n          {chart.elements.map((elem) => {\n            return (\n              <dl key={elem}>\n                <dt>\n                  <Typography variant=\"h6\" component=\"h2\">\n                    {_.get(\n                      chart,\n                      [\"textValues\", `${elem}_row`, G.DISPLAY_NAME],\n                      \"\"\n                    )}\n                  </Typography>\n                </dt>\n                <dd>\n                  <Typography variant=\"h4\" component=\"h2\">\n                    {_.get(\n                      chart,\n                      [\"textValues\", `${elem}_row`, G.DISPLAY_VALUE],\n                      chart.textValues[elem]\n                    )}\n                  </Typography>\n                </dd>\n              </dl>\n            );\n          })}\n        </Box>\n      </>\n    );\n  };\n\n  const getChart = (chart) => {\n    // TODO: simplify\n    if (!chart) return null;\n    const { type, chartId, name } = chart;\n\n    // if (type === \"text\") {\n    if (chartId === \"intro\") {\n      return (\n        <Box\n          sx={{\n            // background: { xs: \"red\", sm: \"blue\", md: \"green\", lg: \"yellow\", xl: \"purple\" },\n            flexBasis: { xs: \"100%\", xl: 600 },\n            flexGrow: { xl: 0 },\n            p: 3,\n            // display: {md: \"flex\"},\n          }}\n          key={chartId}\n        >\n          {getIntro(chart)}\n        </Box>\n      );\n    }\n\n    if (type === \"table\") {\n      return (\n        <Box sx={{ flexBasis: \"100%\", maxWidth: 864, p: 3 }} key={chartId}>\n          <Typography variant=\"h5\" component=\"h3\">\n            {name}\n          </Typography>\n          {getTable(chart)}\n        </Box>\n      );\n    }\n\n    if (type === \"nested\") {\n      return (\n        <>\n          <Box\n            sx={{\n              flexBasis: { xs: \"100%\", xl: 700 },\n              flexGrow: { xl: 1 },\n              flexShrink: { xl: 1 },\n              mr: \"auto\",\n              ml: { xl: \"auto\" },\n              maxWidth: 864,\n              p: 3,\n            }}\n            key={chartId}\n          >\n            <Typography pb={3} variant=\"h5\" component=\"h3\">\n              {name}\n            </Typography>\n            {getNested(chart)}\n          </Box>\n          <Box sx={{ flexBasis: \"100%\", height: 0 }} />\n        </>\n      );\n    }\n    // if (chart.type === \"area\") return getAreaChart(chart);\n    return (\n      <Box\n        key={chartId}\n        sx={{\n          width: \"100%\",\n          maxWidth: { md: \"44%\", xl: \"29%\" },\n          p: 3,\n        }}\n      >\n        <Typography variant=\"h5\" component=\"h3\">\n          {name}\n        </Typography>\n        {getLineChart(chart)}\n      </Box>\n    );\n  };\n\n  return (\n    <Box\n      display=\"flex\"\n      flexWrap=\"wrap\"\n      pt={8}\n      sx={{\n        justifyContent: { xs: \"space-evenly\", md: \"space-between\" },\n      }}\n    >\n      {chartData.map(getChart)}\n    </Box>\n  );\n};\n","// import \"./styles.css\";\nimport React from \"react\";\nimport _ from \"lodash\";\nimport { getSiteData, getChartData } from \"../getData\";\nimport { themePrimary, radColors, getRC } from \"../consts/colors\";\nimport { Container, Paper, Typography, useTheme } from \"@mui/material\";\nimport { Header } from \"./Header\";\nimport { Charts } from \"./Charts\";\nimport { Box } from \"@mui/system\";\nimport { transformLink } from \"../utils/display\";\n\nconst homeTexts = [\n  `\nOverview: The WHO Differentiated Services Delivery Strategic Initiatives dashboard brings together data on HIV testing services from various sources into one visual tool. We would like to acknowledge the support of the Ministries of Health of Member States, UNAIDS, the Bill and Melinda Gates Foundation, the President’s Emergency Programme for AIDS Relief (PEPFAR), USAID, the World Health Organization, and the Global Fund to Fight AIDS, Tuberculosis and Malaria. This project aims to provide local level data for in country action for policy-makers, programme directors, outreach workers and community activists among others. The most recent data available has been collected from the relevant organisation including UNAIDS (Spectrum estimates, Global AIDS Monitoring and the Key Population Atlas), UNPOP, UNICEF and the World Bank. USAID/PEPFAR have kindly provided HIV testing data by approach. Data gaps have been filled (where possible) by reviewing publicly available sources, most notably from Ministries of Health and PEPFAR country operational plans. All dashboards have been viewed and approved by the Ministries of Health. This dashboard does not cover in-depth policy information, PrEP or paediatric HIV testing but includes links to relevant sites that do cover this information.`,\n  `Contact: Cheryl Case Johnson (johnsonc@who.int)`,\n];\n\nconst SHOW_COLORS = false;\n\nexport default function App() {\n  const [selectedIso, setIso] = React.useState(null);\n  const [chartData, setChartData] = React.useState([]);\n\n  const [dictionary, setDictionary] = React.useState([]);\n  const [countries, setCountries] = React.useState([]);\n  const [chartIds, setChartIds] = React.useState([]);\n  const [chartConfigsMap, setChartConfigsMap] = React.useState(null);\n\n  // on page load, get site-wide data\n  React.useEffect(() => {\n    getSiteData().then((result) => {\n      setDictionary(result.dictionary.filter((d) => d.term && d.definition));\n      setCountries(result.countries.filter((c) => c.iso && c.name));\n      setChartIds(result.chartIds);\n      setChartConfigsMap(result.chartConfigsMap);\n    });\n  }, []);\n\n  // on country selection change, get country-specific chart data\n  React.useEffect(() => {\n    if (!selectedIso) return;\n    getChartData({ chartConfigsMap, chartIds, selectedIso }).then((result) => {\n      console.log(\"@@@ ALL DATA: \");\n      console.log(result.charts);\n      setChartData(result.charts);\n    });\n  }, [selectedIso]);\n\n  const updateCountry = (e) => {\n    const value = e.target.value;\n    const realIso = _.some(countries, ({ iso }) => iso === value);\n    setIso(realIso ? value : null);\n  };\n\n  // console.log(\"*\", chartData);\n  const loading = !_.some(chartData, (c) => c && c.countryIso === selectedIso);\n\n  const theme = useTheme();\n  return (\n    <Paper\n      elevation={0}\n      sx={{\n        // keep in sync with index.html background\n        background: getRC(themePrimary, 3),\n        color: getRC(themePrimary, 12),\n        fontFamily: theme.typography.fontFamily,\n        p: { lg: 6 },\n      }}\n    >\n      <Header\n        countries={countries}\n        handleCountryChange={updateCountry}\n        selectedIso={selectedIso}\n      />\n      <br />\n\n      {!selectedIso ? (\n        <Box pt={\"20vh\"}>\n          {homeTexts.map((text, i) => (\n            <Typography\n              variant=\"body1\"\n              key={i}\n              sx={{ maxWidth: 600, margin: \"auto\" }}\n              pt={2}\n              px={3}\n              dangerouslySetInnerHTML={{\n                __html: text,\n              }}\n            />\n          ))}\n        </Box>\n      ) : loading ? (\n        <Box pt={\"50vh\"}>\n          <Typography\n            variant=\"body1\"\n            sx={{ textAlign: \"center\" }}\n            dangerouslySetInnerHTML={{\n              __html: \"loading...\",\n            }}\n          />\n        </Box>\n      ) : (\n        <Charts\n          countries={countries}\n          selectedIso={selectedIso}\n          chartData={chartData}\n        />\n      )}\n      {!!dictionary.length && !loading && (\n        <Box\n          sx={{\n            px: { xs: 3, lg: 10 },\n            mx: { lg: 5 },\n            mb: { lg: 5 },\n            py: 9,\n            mt: 9,\n            background: theme.palette.background.paper,\n          }}\n        >\n          <Typography\n            variant=\"h4\"\n            component=\"h2\"\n            dangerouslySetInnerHTML={{\n              __html: \"Glossary\",\n            }}\n          />\n          <Box\n            sx={{\n              columnCount: { md: 2, xl: 3 },\n              columnGap: { xs: \"2rem\", lg: \"5rem\" },\n              mt: 3,\n              \"& dl\": {\n                display: \"inline-block\",\n                mt: 0,\n                mb: { lg: 3 },\n              },\n              \"& dd\": { ml: 0, mt: { xs: 1 } },\n            }}\n          >\n            {dictionary\n              .sort((a, b) => a.term.toLowerCase() > b.term.toLowerCase())\n              .map(({ term, definition }) => {\n                return (\n                  <dl>\n                    <dt>\n                      <strong>{term}</strong>\n                    </dt>\n                    <dd>\n                      <Typography\n                        // sx={{ maxWidth: \"500px\" }}\n                        dangerouslySetInnerHTML={{\n                          __html: transformLink(definition),\n                        }}\n                      />\n                    </dd>\n                  </dl>\n                );\n              })}\n          </Box>\n        </Box>\n      )}\n      {SHOW_COLORS &&\n        radColors.map((rc) => (\n          <>\n            <br></br>\n            {_.map(Object.keys(radColors[0]), (meh, idx) => (\n              <span\n                style={{\n                  background: getRC(rc, idx + 1),\n                  height: \"70px\",\n                  width: \"70px\",\n                  display: \"inline-block\",\n                  textAlign: \"center\",\n                }}\n              >\n                {idx + 1}\n              </span>\n            ))}\n            {Object.keys(rc)[0].replace(/\\d/, \"\")}\n          </>\n        ))}\n    </Paper>\n  );\n}\n","import { render } from \"react-dom\";\n\nimport App from \"./components/App\";\nimport { ThemeProvider, createTheme } from '@mui/material/styles';\nimport { getRC, themePrimary, themeSecondary } from \"./consts/colors\";\n// import { red } from '@mui/material/colors';\n\nconst theme = createTheme({\n  palette: {\n    primary: {\n      main: getRC(themePrimary, 11),\n    },\n    secondary: {\n      main: getRC(themeSecondary, 8),\n    },\n  },\n  typography: {\n    fontFamily: [\n      'Archivo',\n      'sans-serif',\n    ].join(','),\n  },\n});\n\nfunction ThemedApp() {\n  return <ThemeProvider theme={theme}><App /></ThemeProvider>;\n}\n\n\nconst rootElement = document.getElementById(\"root\");\nrender(<ThemedApp />, rootElement);\n","import _ from \"lodash\";\n\nexport const capValue = (v, options = {}) => {\n  v = Number(v);\n  // !_.isEmpty(options) && console.log(\"cvOPTIONS: \", v, options);\n  if (options.cap) return Math.min(v, Number(options.cap));\n  return v;\n};\n\nexport const displayPercent = (v, options = {}) => {\n  // !_.isEmpty(options) && console.log(\"OPTIONS: \", v, options);\n  v = Number(v);\n  if (!isFinite(v)) return \"NA\";\n  if (options.cap && v > Number(options.cap)) {\n    const x = `>${options.cap}%`;\n    // console.log(\"!!!!\", x, v, options.cap);\n    return x;\n  }\n  if (v > 100) console.warn(\"Incorrect %\");\n\n  const decimals = options.decimals || 0;\n  return _.round(v, decimals).toString() + \"%\";\n};\n\nexport const displayNumber = (v, options = {}) => {\n  v = Number(v);\n  if (options.coarseFormatting) {\n    if (v > 1000000000) {\n      return _.round(v / 1000000000, 1).toString() + \" billion\";\n    } else if (v > 1000000) {\n      return _.round(v / 1000000, 1).toString() + \" million\";\n    } else if (v < 100) {\n      return \"<100\";\n    } else if (v < 200) {\n      return \"<200\";\n    } else if (v < 500) {\n      return \"<500\";\n    } else if (v < 1000) {\n      return \"<1000\";\n    } else {\n      v = Number(v.toPrecision(2));\n    }\n  }\n\n  // insert spaces rather than commas\n  return v.toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, \"$1 \");\n};\n\nexport const transformLink = (t) =>\n  t.replaceAll(\"<a \", \"<a target='_blank' rel='noopener noreferrer'\");\n"],"sourceRoot":""}